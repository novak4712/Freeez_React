import React, {useEffect, useContext} from "react";

import styles from './ServicesCart.module.scss'
import useFetch from 'hooks/useFetch';
import ButtonFreeez from "components/ButtonFreeez";
import {CurrentThemeContext} from "contexts/currentTheme";

import getField from 'utilities/getField';

const ServicesCart = ({idCategory}) => {
    const [currentThemeState] = useContext(CurrentThemeContext);
    const apiUrl = `/wp-json/wp/v2/services?categories=${idCategory}`
    const memberPrice = currentThemeState.isLang === 'ru' ? 'членство' : 'member price';
    const [{response, isLoading}, doFetch] = useFetch(apiUrl)
    let data = []
    useEffect(() => {
        doFetch()
    }, [doFetch])

    if (response) {
        data = response

    }
    return (
        <React.Fragment>
            {(isLoading) ? <div>Loading...</div> :
                data.map((item) => {
                    const content = getField('content', item)
                    return (
                        <div className={`${styles.cartItemWrapper} ${currentThemeState.isLight ? styles.light : styles.dark}`} key={item.id}>
                            <div className={`${styles.cartItem} ${styles.left}`}>
                                <div className={styles.header}>
                                    <div className={styles.name}>
                                        {item['service-name']}
                                    </div>
                                    <div className={styles.duration}>
                                        {item.duration}
                                    </div>
                                    <div className={styles.price}>
                                        {item.price} BYR
                                    </div>
                                </div>
                                <div
                                    className={`${styles.memberPriceWrapper} ${item['member-price'] ? styles.viz : styles.notViz}`}>
                                    <div className={styles.memberPriceHr}>{item['service-name']}</div>
                                    <div className={styles.memberPriceText}>{memberPrice}</div>
                                    <div className={styles.memberPriceValue}>{item['member-price']} BYR</div>
                                </div>
                                <div className={styles.cartContentWrapper}>
                                    <ul>
                                        {content.map((item, idx) => (
                                            <li className={styles.cartContentItem} key={`item-${idx}`}>{item['content-item']}</li>
                                        ))}
                                    </ul>
                                </div>
                            </div>
                            <ButtonFreeez text='ADD TO SHOPPING BAG' close='Plus' theme='dark' width='300px'
                                          align='left'/>
                        </div>
                    )
                })
            }
        </React.Fragment>

    )
}
export default ServicesCart
