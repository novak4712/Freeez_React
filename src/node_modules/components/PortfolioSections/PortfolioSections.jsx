import React, {useEffect, useContext, useState} from "react";

import styles from './PortfolioSections.module.scss'
import useFetch from 'hooks/useFetch';
import subArray from "utilities/subArray";
import {CurrentThemeContext} from "contexts/currentTheme";

const PortfolioSections = ({getSection}) => {
    const [currentThemeState] = useContext(CurrentThemeContext);
    const parentCategory = currentThemeState.isLang === 'ru' ? 32 : 34;
    const apiUrl = `/wp-json/wp/v2/categories?per_page=100`;
    const [{response, isLoading}, doFetch] = useFetch(apiUrl);
    const [currentSection, setCurrentSection] = useState(null)
    let data = [];

    const handlerSection = (id) => {
        const section = (id === currentSection) ? null : id;
        setCurrentSection(section)
        getSection(section)
    }


    useEffect(() => {
        doFetch()
    }, [doFetch])

    if (response) {
        data = response.filter(item => item.parent === parentCategory && item.lang === currentThemeState.isLang)
        data = subArray(data, 3).slice(0, 2);
    }

    return ((isLoading) ? <div>Loading...</div> :
            <div className={`${styles.portfolioSections} ${currentThemeState.isLight ? styles.light : styles.dark}`}>
                {data.map((item, idx) => {
                    return (
                        <div className={styles.sectionWrapper} key={`section-${idx}`}>
                            {item.map((item) => {
                                return (
                                    <div className={`${styles.section} ${currentSection === item.id ? styles.active : ''}`}
                                         key={item.id} onClick={() => handlerSection(item.id)}>
                                        {item.name}
                                    </div>
                                )
                            })}
                        </div>
                    )
                })}
            </div>
    )
}
export default PortfolioSections
