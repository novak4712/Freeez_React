import React, {useContext, useState, useEffect} from "react";
import {Link} from "react-router-dom";
import ReactPageScroller from 'react-page-scroller';

import ScrollTip from "components/ScrollTip";
import subArray from 'utilities/subArray.js';

import styles from './SingleContacts.module.scss'
import {CurrentThemeContext} from "contexts/currentTheme";
import PageLink from "components/PageLink";
import useFetch from 'hooks/useFetch';
import SinglePhoto from "components/SinglePhoto";


const SingleContacts = (props) => {
    const works = props.location.state;
    const [currentThemeState] = useContext(CurrentThemeContext);
    const [currentPage, setCurrentPage] = useState(null);
    const lang = currentThemeState.isLang === 'ru' ? 22 : 19;
    let apiUrl = `/wp-json/wp/v2/portfolio?language=${lang}`;
    const [{response, isLoading}, doFetch] = useFetch(apiUrl);

    let data = [];

    const handlePageChange = (number) => {
        setCurrentPage(number)
    };

    useEffect(() => {
        doFetch()

    }, [doFetch, lang])

    if (response) {
        if (works.constructor === Array) {
            data = works.map((el) => response.filter((item) => item.id === +el)).flat(Infinity)
        } else {
            data = response.filter((item) => item.id === +works)
        }
        data = subArray(data, 8);
    }



    return (
        <div className={`${styles.singleContactsWrapper} ${currentThemeState.isLight ? styles.light : styles.dark}`}>
            <ScrollTip currentPage={currentPage} length={data.length} />
            {(isLoading) ? <div>Loading...</div> :
                (data.length > 1) ?
                    <ReactPageScroller
                        containerWidth='100%'
                        containerHeight='100%'
                        transitionTimingFunction='ease-in-out'
                        pageOnChange={handlePageChange}
                        customPageNumber={currentPage}
                        blockScrollDown={currentPage === data.length - 1}
                    >
                        {
                            data.map((item, idx) => {
                                return (
                                    <div className={styles.singleContacts} key={`item-${idx}`} >
                                        {
                                            item.map((item) => {
                                                return (
                                                    <Link to={{
                                                        pathname: `/portfolio/${item.slug}`,
                                                        state: item.id
                                                    }} className={styles.workItem}
                                                          key={item.id}>
                                                        <div className={styles.content}>
                                                            <SinglePhoto id={item.id} idImg={item.preview_img_worker} />
                                                        </div>
                                                        <div className={styles.hashTag}>
                                                            #{item.name}
                                                        </div>
                                                    </Link>
                                                )
                                            })
                                        }
                                    </div>
                                )
                            })
                        }
                    </ReactPageScroller>:
                    <React.Fragment>
                        {
                            data.map((item, idx) => {

                                return (
                                    <div className={styles.singleContacts} key={`item-${idx}`}>
                                        {
                                            item.map((item) => {
                                                return (
                                                    <Link to={{
                                                        pathname: `/portfolio/${item.slug}`,
                                                        state: item.id
                                                    }} className={styles.workItem}
                                                          key={item.id}>
                                                        <div className={styles.content}>
                                                            <SinglePhoto id={item.id} idImg={item.preview_img_worker} />
                                                        </div>
                                                        <div className={styles.hashTag}>
                                                            #{item.name}
                                                        </div>
                                                    </Link>
                                                )
                                            })
                                        }
                                    </div>
                                )
                            })
                        }
                    </React.Fragment>
            }
            <PageLink text='BACK' url='/our_team'/>
        </div>
    )
};


export default SingleContacts;
