import React, {useContext, useState} from "react";
import {Link} from 'react-router-dom';
import axios from 'axios';

import {CurrentThemeContext} from "contexts/currentTheme";
import ButtonFreeez from 'components/ButtonFreeez'

import styles from './Registration.module.scss'


const Registration = () => {
    const [currentThemeState] = useContext(CurrentThemeContext);
    const [username, setUsername] = useState('');
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');

    const handleSubmit = (event) => {
        event.preventDefault();
        getWPnonce();
    }

    const getWPnonce = () => {
        axios.get('https://sergei-sorokin.ru/api/get_nonce/?controller=user&method=register')
            .then(res => {
               insertData(res.data.nonce);
            }).catch(error => {
            console.log(error.response)
        });
    }

    const insertData = (nonce) =>{
        axios.get(`https://sergei-sorokin.ru/api/user/register/?username=${username}&email=${email}&nonce=${nonce}&user_pass=${password}&insecure=cool`)
            .then(res => {
                const data = res.data;
                console.log(data);
            }).catch(error => {
            console.log(error.response)
        });
    }

    return (
        <div className={`${styles.registrationWrapper} ${currentThemeState.isLight ? styles.light : styles.dark}`}>
            <div className={styles.registration}>
                <form className={styles.form} onSubmit={handleSubmit}>
                    <div className={styles.inputWrapper}>
                        <input className={styles.input} placeholder='USERNAME' type='text' value={username}
                               onChange={event => setUsername(event.target.value)} name='username'/>
                    </div>
                    <div className={styles.inputWrapper}>
                        <input className={styles.input} placeholder='E-MAIL ADDRESS' type='email' value={email}
                               onChange={event => setEmail(event.target.value)} name='email'/>
                    </div>
                    <div className={styles.inputWrapper}>
                        <input className={styles.input} placeholder='PASSWORD' type='password' value={password}
                               onChange={event => setPassword(event.target.value)} name='password'/>
                    </div>
                    <div className={styles.privacyPolicy}>
                        Your personal data will be used to support your experince throughout this website, to manage
                        access to your account, and for other purposes described in our <Link to='/privacy_policy'
                                                                                              className={styles.link}>privacy
                        policy</Link>.
                    </div>
                    <div className={styles.buttonWrapper}>
                        <ButtonFreeez text='REGISTER' theme='light' width='300px' align='center' type='submit'/>
                    </div>
                    <div className={styles.linkWrapper}>
                        <div className={styles.linkItem}>
                            Already have an account? <Link to='/authentication' className={styles.link}>Sign In</Link>.
                        </div>
                    </div>
                </form>
            </div>
        </div>
    )
};

export default Registration;
