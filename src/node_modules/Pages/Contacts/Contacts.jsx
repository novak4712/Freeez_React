import React, {useContext, useState, useEffect} from "react";
import {Link} from "react-router-dom";
import ReactPageScroller from 'react-page-scroller';

import ScrollTip from "components/ScrollTip";
import SinglePhoto from "components/SinglePhoto";
import subArray from 'utilities/subArray.js';

import styles from './Contacts.module.scss'
import {CurrentThemeContext} from "contexts/currentTheme";
import useFetch from 'hooks/useFetch';
import getField from 'utilities/getField';


const Contacts = () => {
    const [currentThemeState] = useContext(CurrentThemeContext);
    const [currentPage, setCurrentPage] = useState(null);
    const lang = currentThemeState.isLang === 'ru' ? 22 : 19;
    let apiUrl = `/wp-json/wp/v2/workers?language=${lang}`;
    const [{response, isLoading}, doFetch] = useFetch(apiUrl);
    const portfolio = currentThemeState.isLang === 'ru' ? 'ПОРТФОЛИО' : 'PORTFOLIO';
    let data = [];


    const handlePageChange = (number) => {
        setCurrentPage(number)
    };

    useEffect(() => {
        doFetch()
    }, [doFetch, lang])

    if (response) {
        data = subArray(response, 6);
    }


    return (
        <div className={`${styles.contactsWrapper} ${currentThemeState.isLight ? styles.light : styles.dark}`}>
            <ScrollTip currentPage={currentPage} length={data.length}/>
            {(isLoading) ? <div>Loading...</div> :
                (data.length > 1) ? <ReactPageScroller
                        containerWidth='100%'
                        containerHeight='100%'
                        transitionTimingFunction='ease-in-out'
                        pageOnChange={handlePageChange}
                        customPageNumber={currentPage}
                        blockScrollDown={currentPage === data.length - 1}
                    >
                        {data.map((item, idx) => {
                            return (
                                <div className={styles.contacts} key={`item-${idx}`}>
                                    {item.map((person) => {
                                        const position = getField('worker-position', person).filter((item) => item['worker-posistion-name'].length > 0);
                                        return (
                                            <div className={styles.personWrapper} key={`${person.id}`}>
                                                <div className={styles.contentWrapper}>
                                                    <div className={styles.personHeader}>
                                                        <div className={styles.personPhoto}>
                                                            <div className={styles.skullImage}>
                                                                <SinglePhoto id={person.id} idImg={person['worker-img']}/>
                                                            </div>
                                                            <div className={styles.normImage}>
                                                                <SinglePhoto id={person.id}
                                                                             idImg={person['worker-img-norm']}/>
                                                            </div>
                                                        </div>
                                                        <div className={styles.personContent}>
                                                            <div className={styles.personName}>
                                                                {person.worker_name}
                                                            </div>
                                                            <div className={styles.personText}>
                                                                {person['worker-detail-text']}
                                                            </div>
                                                        </div>

                                                    </div>
                                                    <div className={styles.personFooter}>
                                                        <Link to={{
                                                            pathname: `/our_team/${person.slug}`,
                                                            state: {
                                                                works: person['work-in-portfolio'],
                                                                id: person.id
                                                            }
                                                        }} className={styles.personButton}>
                                                            {portfolio}
                                                        </Link>
                                                        <div className={styles.personPosition}>
                                                            {position.map((item, idx) => {
                                                                return (
                                                                    <div
                                                                        className={`${styles.personalPositionItem}  ${(position.length === 1) ? styles.positionItem100 : styles.positionItem50}`}
                                                                        key={`item-${idx}`}>
                                                                        {item['worker-posistion-name']}
                                                                    </div>
                                                                )
                                                            })}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        )
                                    })}
                                </div>
                            )
                        })}
                    </ReactPageScroller>
                    : <React.Fragment>
                        {data.map((item, idx) => {
                            return (
                                <div className={styles.contacts} key={`item-${idx}`}>
                                    {item.map((person) => {
                                        const position = getField('worker-position', person).filter((item) => item['worker-posistion-name'].length > 0);
                                        return (
                                            <div className={styles.personWrapper} key={`${person.id}`}>
                                                <div className={styles.contentWrapper}>
                                                    <div className={styles.personHeader}>
                                                        <div className={styles.personPhoto}>
                                                            <div className={styles.skullImage}>
                                                                <SinglePhoto id={person.id} idImg={person['worker-img']}/>
                                                            </div>
                                                            <div className={styles.normImage}>
                                                                <SinglePhoto id={person.id}
                                                                             idImg={person['worker-img-norm']}/>
                                                            </div>
                                                        </div>
                                                        <div className={styles.personContent}>
                                                            <div className={styles.personName}>
                                                                {person.worker_name}
                                                            </div>
                                                            <div className={styles.personText}>
                                                                {person['worker-detail-text']}
                                                            </div>
                                                        </div>

                                                    </div>
                                                    <div className={styles.personFooter}>
                                                        <Link to={{
                                                            pathname: `/our_team/${person.slug}`,
                                                            state: {
                                                                works: person['work-in-portfolio'],
                                                                id: person.id
                                                            }
                                                        }} className={styles.personButton}>
                                                            {portfolio}
                                                        </Link>
                                                        <div className={styles.personPosition}>
                                                            {position.map((item, idx) => {
                                                                return (
                                                                    <div
                                                                        className={`${styles.personalPositionItem}  ${(position.length === 1) ? styles.positionItem100 : styles.positionItem50}`}
                                                                        key={`item-${idx}`}>
                                                                        {item['worker-posistion-name']}
                                                                    </div>
                                                                )
                                                            })}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        )
                                    })}
                                </div>
                            )
                        })}
                    </React.Fragment>
            }
        </div>
    )
};

export default Contacts;
